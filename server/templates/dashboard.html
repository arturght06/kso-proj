{% extends "base.html" %}

{% block content %}
<h2>System Overview</h2>

<div class="card">
    <h3>Active Hosts</h3>
    {% if hosts %}
        <table>
            <thead>
                <tr>
                    <th>Hostname</th>
                    <th>IP Address</th>
                    <th>Last Heartbeat</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for host in hosts %}
                <tr>
                    <td>
                        <a href="{{ url_for('host_details', host_id=host.id) }}" style="font-weight: bold; color: #2980b9; text-decoration: none;">
                            {{ host.hostname }}
                        </a>
                    </td>
                    <td>{{ host.ip_address }}</td>
                    <td>{{ host.last_heartbeat.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                    <td>
                        <span style="color: {{ 'green' if host.is_active else 'red' }}">
                            {{ 'Online' if host.is_active else 'Offline' }}
                        </span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No hosts registered yet.</p>
    {% endif %}
</div>

<div class="card">
    <h3>Recent Audit Logs</h3>
    {% if logs %}
        <table>
            <thead>
                <tr>
                    <th>Time</th>
                    <th>Host</th>
                    <th>Program</th>
                    <th>Message</th>
                    <th>Severity</th>
                </tr>
            </thead>
            <tbody>
                {% for log in logs %}
                <tr>
                    <td>{{ log.timestamp.strftime('%H:%M:%S') }}</td>
                    <td>{{ log.host.hostname }}</td>
                    <td>{{ log.program }}</td>
                    <td>{{ log.message[:100] }}...</td>
                    <td style="font-weight: bold; color: {{ 'red' if log.severity.value == 'critical' else 'orange' if log.severity.value == 'warning' else 'black' }}">
                        {{ log.severity.value }}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No logs received yet.</p>
    {% endif %}
</div>
{% endblock %}